import { Steps } from 'nextra/components'
import InfoIcon from '../../../../src/components/icons/info.jsx'

> <InfoIcon /> To use WebNN before the [Origin Trial](https://developer.chrome.com/docs/web-platform/origin-trials) milestone, complete these setup requirements.

- Window 11, version 21H2 or newer
- It's recommended to install the latest [Intel® Arc™ & Iris® Xe Graphics on Windows](https://www.intel.com/content/www/us/en/download/785597/intel-arc-iris-xe-graphics-windows.html) for improved WebNN compatibility and performance

## Enabling WebNN

<Steps>
### Download and install the latest [Chrome Canary](https://google.com/chrome/canary) or [Edge Canary](https://www.microsoft.com/en-us/edge/download/insider?form=MA13FJ)
### Navigate to `about://flags` in browser address bar
### Search for `Enables WebNN API` and change it to `Enabled`
### Exit browser
</Steps>

## Running WebNN on CPU or GPU

<Steps>
### Launch Chrome Canary or Edge Canary

```bash copy showLineNumbers filename="launch-chrome-canary"
  "%LOCALAPPDATA%\Google\Chrome SxS\Application\chrome.exe"
```

```bash copy showLineNumbers filename="launch-edge-canary"
  "%LOCALAPPDATA%\Microsoft\Edge SxS\Application\msedge.exe"
```


</Steps>

## Running WebNN on NPU

- Window 11, version 24H2 or newer
- It's recommended to install the latest [Intel® Core™ Ultra NPU Driver on Windows](https://www.intel.com/content/www/us/en/download/794734/intel-npu-driver-windows.html) for improved WebNN compatibility and performance

<details open>
  {/* prettier-ignore */}
  <summary>Chrome Canary</summary>
  <div className="mx-2 my-2">
  <Steps>
    ### Prepare the `DirectML.dll`
    
    Download the latest redistributable [Microsoft.AI.DirectML](https://www.nuget.org/packages/Microsoft.AI.DirectML/1.15.2), rename `microsoft.ai.directml.[version].nupkg` to `microsoft.ai.directml.[version].nupkg.zip` and extract it

    ### Put the `DirectML.dll` into correct path
    
    Copy `\bin\x64-win\DirectML.dll` to `%LOCALAPPDATA%\Google\Chrome SxS\Application\[version]\`
        - `%LOCALAPPDATA%` means `C:\Users\<username>\AppData\Local\`
        - Note that Chrome Canary frequently updates automatically. When this occurs, recopy the `DirectML.dll` to the new version's directory.
    ### Launch Chrome Canary in Windows Command Line
    
    ```bash copy showLineNumbers filename="enable-webnn-npu-chrome-canary"
      "%LOCALAPPDATA%\Google\Chrome SxS\Application\chrome.exe" --use-redist-dml --disable_webnn_for_npu=0
    ```
  </Steps>
  </div>
</details>
<details open>
  {/* prettier-ignore */}
  <summary>Edge Canary</summary>
  <div className="mx-2 my-2">
    <Steps>
      ### Ensure the `DirectML.dll` was downloaded automatically
          - Launch Edge Canary
          - Go to `%LOCALAPPDATA%\Microsoft\Edge SxS\User Data`, check the `EdgeOnnxRuntimeDirectML\[version]\DirectML.dll` exists
          - `%LOCALAPPDATA%` means `C:\Users\<username>\AppData\Local\`
          - Exit Edge Canary
      ### Launch Edge Canary in Windows Command Line

      ```bash copy showLineNumbers filename="enable-webnn-npu-edge-canary"
        "%LOCALAPPDATA%\Microsoft\Edge SxS\Application\msedge.exe" --disable_webnn_for_npu=0
      ```

      ### Force to download the `DirectML.dll` manually
      
      If `EdgeOnnxRuntimeDirectML\[version]\DirectML.dll` does not exist under `%LOCALAPPDATA%\Microsoft\Edge SxS\User Data`:
          - Go to `edge://components/`
          - Click Check for update button of Edge Video Super Resolution
          - Repeat step 2
    </Steps>
  </div>
</details>
